(function(e,t){typeof module=="object"&&typeof module.exports=="object"?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("Geetest requires a window with a document");return t(e)}:t(e)})(typeof window!="undefined"?window:this,function(e,t){function s(e){this._obj=e}function o(e){var t=this;(new s(e))._each(function(e,n){t[e]=n})}if(typeof e=="undefined")throw new Error("Geetest requires browser environment");var n=e.document,r=e.Math,i=n.getElementsByTagName("head")[0];s.prototype={_each:function(e){var t=this._obj;for(var n in t)t.hasOwnProperty(n)&&e(n,t[n]);return this}},o.prototype={api_server:"api.geetest.com",protocol:"http://",type_path:"/gettype.php",fallback_config:{slide:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"slide",slide:"/static/js/geetest.0.0.0.js"},fullpage:{static_servers:["static.geetest.com","dn-staticdown.qbox.me"],type:"fullpage",fullpage:"/static/js/fullpage.0.0.0.js"}},_get_fallback_config:function(){var e=this;return a(e.type)?e.fallback_config[e.type]:e.new_captcha?e.fallback_config.fullpage:e.fallback_config.slide},_extend:function(e){var t=this;(new s(e))._each(function(e,n){t[e]=n})}};var u=function(e){return typeof e=="number"},a=function(e){return typeof e=="string"},f=function(e){return typeof e=="boolean"},l=function(e){return typeof e=="object"&&e!==null},c=function(e){return typeof e=="function"},h={},p={},d=function(){return parseInt(r.random()*1e4)+(new Date).valueOf()},v=function(e,t){var r=n.createElement("script");r.charset="UTF-8",r.async=!0,r.onerror=function(){t(!0)};var s=!1;r.onload=r.onreadystatechange=function(){!s&&(!r.readyState||"loaded"===r.readyState||"complete"===r.readyState)&&(s=!0,setTimeout(function(){t(!1)},0))},r.src=e,i.appendChild(r)},m=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},g=function(e){return e=e.replace(/\/+/g,"/"),e.indexOf("/")!==0&&(e="/"+e),e},y=function(e){if(!e)return"";var t="?";return(new s(e))._each(function(e,n){if(a(n)||u(n)||f(n))t=t+encodeURIComponent(e)+"="+encodeURIComponent(n)+"&"}),t==="?"&&(t=""),t.replace(/&$/,"")},b=function(e,t,n,r){t=m(t);var i=g(n)+y(r);return t&&(i=e+t+i),i},w=function(e,t,n,r,i){var s=function(o){var u=b(e,t[o],n,r);v(u,function(e){e?o>=t.length-1?i(!0):s(o+1):i(!1)})};s(0)},E=function(t,n,r,i){if(l(r.getLib)){r._extend(r.getLib),i(r);return}if(r.offline){i(r._get_fallback_config());return}var s="geetest_"+d();e[s]=function(t){t.status==="success"?i(t.data):t.status?i(r._get_fallback_config()):i(t),e[s]=undefined;try{delete e[s]}catch(n){}},w(r.protocol,t,n,{gt:r.gt,callback:s},function(e){e&&i(r._get_fallback_config())})},S=function(e,t){var n={networkError:"网络错误"};if(typeof t.onError!="function")throw new Error(n[e]);t.onError(n[e])},x=function(){return!!e.Geetest};x()&&(p.slide="loaded");var T=function(t,n){var r=new o(t);t.https?r.protocol="https://":t.protocol||(r.protocol=e.location.protocol+"//"),E([r.api_server||r.apiserver],r.type_path,r,function(t){var i=t.type,s=function(){r._extend(t),n(new e.Geetest(r))};h[i]=h[i]||[];var o=p[i]||"init";o==="init"?(p[i]="loading",h[i].push(s),w(r.protocol,t.static_servers||t.domains,t[i]||t.path,null,function(e){if(e)p[i]="fail",S("networkError",r);else{p[i]="loaded";var t=h[i];for(var n=0,s=t.length;n<s;n+=1){var o=t[n];c(o)&&o()}h[i]=[]}})):o==="loaded"?s():o==="fail"?S("networkError",r):o==="loading"&&h[i].push(s)})};return e.initGeetest=T,T});