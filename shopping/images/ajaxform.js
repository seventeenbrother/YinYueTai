define(["require","uri","modules/yinyuetai/secret"],function(e){function i(){var e,t;e=this.$el,t=this.options,e.submit(function(n){n.preventDefault(),o(e,r[t.secretName].apply(window,t.secretParam())),t.onRequest.call(e)&&(console.log(e.serialize()),$.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),success:function(n){t.onComplete.call(e,n)}}))})}function s(e){function l(e){e.preventDefault();if(n.onRequest.call(t)){if(f)return!1;f=!0,t.off("submit"),o(t,r[u].apply(window,a())),t.submit(),t.on("submit",l)}}var t,n,i,s,u,a,f;return t=this.$el,n=this.options,u=n.secretName,a=n.secretParam,$("<input />").attr({type:"hidden",name:"cross_post",value:"1"}).appendTo(t),i=$("<iframe name="+e+"/>").attr({id:e,src:"about:blank"}).css("display","none").appendTo(document.body),i.on("load",function(){var t;try{t=$("#"+e)[0].contentWindow.document.body}catch(r){n.onError.call("上传错误")}f=!1;try{var t=$("#"+e)[0].contentWindow.document.body;s=t.innerText,s||(s=t.innerHTML),s&&n.onComplete.call(null,$.parseJSON(s))}catch(r){n.onComplete.call(null)}}),t.on("submit",l),i}function o(e,t){$.each(t,function(t,n){var r=e.find("[name="+t+"]");r.length===0?$("<input />").attr({type:"hidden",name:t,value:n}).appendTo(e):r.val(n)})}function u(e,n){return n=n||{},n.el=e,new t(n)}var t,n,r;return n=e("uri"),r=e("modules/yinyuetai/secret"),t=Backbone.View.extend({options:{secretName:"des",secretParam:function(){return[]},onRequest:function(){return!0},onComplete:function(e){},onError:function(e){}},initialize:function(e){var t,r;t=this.$el;if(t.attr("target")&&$(t.attr("target")).length!=0)return;(new n(t.attr("action"))).host()!==""||t.find("[type=file]").length!==0?(r="f"+(new Date).getTime(),t.attr("target",r),this.iframe=s.call(this,r)):i.call(this)}}),u});