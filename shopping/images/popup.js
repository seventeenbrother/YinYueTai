define(["require","modules/widget/dialog/mask"],function(e){function d(e,t,n,r,i){$.ajax({url:e,data:t,dataType:n,method:r,success:function(e){i(e)}})}function v(e){var e=e||{};return new t(e)}var t,n,r,n,i,s,o,u,a="vip",f="http://img3.c.yinyuetai.com/others/crowd/180718/0/-M-230b9fb58f42dd36eafd8a3417291ef2_0x0.png",l="http://img1.c.yinyuetai.com/others/crowd/180718/0/-M-d01101f16f0be40388ccf4ab1b953990_0x0.png",c="http://img3.c.yinyuetai.com/others/crowd/180719/0/-M-1442aa4ddca3da176a1075b2fc450e03_0x0.png",h="http://img4.c.yinyuetai.com/others/crowd/180718/0/-M-e34b0540479a634dc79b8e1408c60b79_0x0.png",p=window.location.host.indexOf("beta")==-1?"http://vip.beta.yinyuetai.com/api/noticed/check-noticed":"http://vip.beta.yinyuetai.com/api/noticed/check-noticed";return r=e("modules/widget/dialog/mask"),i={special:{height:"450px"},newvip_alert:{position:"fixed","z-index":"1000",height:"575px",width:"800px",background:' url("'+f+'") no-repeat',top:"0",bottom:"0",left:"0",right:"0",margin:"auto","text-align":" center","padding-top":" 200px","padding-left":"40px","box-sizing":" border-box"},newvipClose:{position:"absolute",top:"85px",right:"15px",height:"17px",width:"17px",background:'url("'+h+'") no-repeat',"background-size":"100%",cursor:"pointer"},newvipClose_hover:{background:'url("'+h+'") no-repeat',"background-position":"0 -17px","background-size":"100%"},newvipAlert_h3:{font:'bold 20px ""',"line-height":"50px"},newvipAlert_ul:{margin:"40px 0"},newvipAlert_li:{"float":"left","margin-right":"25px","list-style":" none",height:"100px",width:"160px",color:"white",background:'url("'+c+'") no-repeat'},paper_price:{"margin-top":"12px","font-size":"26px"},paper_price_i:{"font-size":"18px"},paper_name:{"font-size":"14px"},paper_nonum:{font:'400 18px/95px ""'},newvip_btn:{display:" block",margin:"30px auto",color:"#62e4c5","line-height":" 40px",height:"40px",width:"180px",border:" 1px solid #62e4c5","box-sizing":" border-box"},newvip_msg_a:{color:"#62e4c5"},notice_style:{"font-size":"16px","line-height":"88px"},notice_renew:{margin:"0 auto",color:"#fff","background-color":"rgba(22, 155, 213, 1)",width:"80px",height:"30px","line-height":"30px",cursor:"pointer"}},s={special:{height:"12rem",font:'normal 0.6rem/2rem ""'},newvip_alert:{position:"fixed","z-index":"1000",height:"18rem",width:"15rem",background:' url("'+l+'") no-repeat',"background-size":"100%",top:"0",bottom:"0",left:"0",right:"0",margin:"auto","text-align":" center","padding-top":"4.5rem","box-sizing":" border-box"},newvipClose:{position:"absolute",top:"0",right:"0.3rem",height:"0.7rem",width:"0.7rem",background:'url("'+h+'") no-repeat',"background-size":"100%",cursor:"pointer"},newvipClose_hover:{},newvipAlert_h3:{font:'bold 0.7rem ""',"line-height":"2rem"},newvipAlert_ul:{margin:"0.3rem 0"},newvipAlert_li:{"float":"left","margin-left":"1rem","margin-bottom":"0.5rem","list-style":" none",height:"3rem",width:"6rem",color:"white",background:'url("'+c+'") no-repeat'},paper_price:{"margin-top":"0.2rem","font-size":"1rem"},paper_price_i:{"font-size":"0.6rem"},paper_name:{"font-size":"0.6rem"},paper_nonum:{font:'400 0.6rem/3rem ""'},newvip_btn:{display:" block",margin:"0.5rem auto",color:"#62e4c5","line-height":" 1.6rem",height:"1.6rem",width:"5rem",border:" 1px solid #62e4c5","box-sizing":" border-box"},newvip_msg_a:{color:"#62e4c5"},notice_style:{"font-size":"0.6rem","line-height":"1.8rem"},notice_renew:{height:"1.5rem",width:"5rem","line-height":"1.5rem",margin:"0.8rem auto",color:"#fff","background-color":"rgba(22, 155, 213, 1)","border-radius":"1rem"}},t=Backbone.View.extend({initialize:function(e){o=e.userId,console.log("userId:",o),u=e.type=="regist"?"新人礼包":"会员礼包",e.type=="newvip"?(a="vip",this.createNewvip(),this.fn=this.newVip):e.type=="regist"?(a="regist",this.createNewvip(),this.fn=this.newVip):(this.createNoticevip(),this.fn=this.noticeVip),n=e.device=="wap"?s:i,this.$el.css(n.newvip_alert),this.$el.find(".newvip-close").css(n.newvipClose),this.$el.find(".newvip-title").css(n.newvipAlert_h3),this.$el.find("ul").css(n.newvipAlert_ul),this.$el.find(".newvip-btn").css(n.newvip_btn),this.$el.find(".newvip-msg-a").css(n.newvip_msg_a),this.bindEvent()},createNewvip:function(){$(".newvip-alert").remove(),this.$el=$('<div class="newvip-alert" style="display:none"><i class="newvip-close"></i><h3 class="newvip-title">'+u+"</h3>"+'<ul class="clearfix"></ul>'+'<a class="newvip-btn" href="http://u.yinyuetai.com/setting-paper.html">查看礼包详情</a>'+'<p class="newvip-msg">优惠券领取后，可以在 “<a class="newvip-msg-a" href="http://u.yinyuetai.com/setting-paper.html">个人中心-我的优惠券</a>” 中查看</p>'+"</div>").appendTo(document.body)},createNoticevip:function(){$(".newvip-alert").remove(),this.$el=$('<div class="newvip-alert" style="display:none;"><i class="newvip-close"></i><p class="notice-style"></p><h5 class="notice-style">现在续费还能领取会员惊喜礼包，福利多多！</h5><div class="notice-renew notice-style">立即续费</div></div>').appendTo(document.body)},bindEvent:function(){this.$el.find(".newvip-close").hover(function(e){$(e.target).css(n.newvipClose_hover)},function(e){$(e.target).css(n.newvipClose)}),this.$el.on("click",".newvip-close",function(){$(".newvip-alert").hide().remove(),r.hide()}),this.$el.on("click",".notice-renew",function(){window.location.href="",$(".newvip-alert").hide().remove(),r.hide()})},show:function(){return new Promise(this.fn)},hide:function(){r.hide(),this.$el.fadeOut()},newVip:function(e){var t=$(".newvip-alert");d(p,{userId:o,type:a},"jsonp","get",function(i){console.log(a,"礼包:",i);if(i.noticed){e(!0);return}var s=i.list,o="",u='<li><% if (num){ %><div class="paper-price"><i>￥</i><%= num %></div><p class="paper-name"><%= name %></p><% }else{ %><p class="paper-nonum"><%= name %></p><% } %></li>';s&&s.slice(0,4).forEach(function(e){o+=_.template(u,e)}),t.find("ul").html(o),t.find("li").css(n.newvipAlert_li),t.find(".paper-price").css(n.paper_price),t.find(".paper-price").find("i").css(n.paper_price_i),t.find(".paper-name").css(n.paper_name),t.find(".paper-nonum").css(n.paper_nonum),r.show(),t.fadeIn()})},noticeVip:function(e){var t=$(".newvip-alert");d(p,{userId:o,type:"vip_expired"},"jsonp","get",function(i){console.log("会员到期时间：",i);if(!!i.noticed){e(!0);return}t.find("p").html(i.list[0].msg),t.css(n.special),t.find(".notice-style").css(n.notice_style),t.find(".notice-renew").css(n.notice_renew),r.show(),t.fadeIn()})}}),v});