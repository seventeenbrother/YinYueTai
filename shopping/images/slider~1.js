define(["require","exports","module","jquery.touchswap","juicer"],function(e,t,n){e("jquery.touchswap");var r=Backbone.View.extend({options:{effect:"fade",duration:7e3},events:{"click .J_toggle":"toggle","click .J_goto":"goto",mouseenter:"pause",mouseleave:"play"},initialize:function(e){$.extend(this.options,e);var t=this;this.render(e.data),this.current=0,this.show(this.current),this.$el.swipe({swipe:function(e,n,r,i,s){n=="right"?t.go("prev"):t.go("next")},excludedElements:[],fingers:"all"})},render:function(t){var n=e("juicer"),r;if(t)this.count=t.length,this.$el.html(n.to_html(this.tpl,{images:t}));else{var i=this.count=this.$el.find("li").length;if(this.count>1){var s=[];for(var o=0;o<i;o++)o==0?s.push('<a href="javascript:;" class="J_goto cur" data-index="'+o+'">●</a>'):s.push('<a href="javascript:;" class="J_goto" data-index="'+o+'">●</a>');r=this.$el.find(".J_nav"),r.html(s.join("")),this.$el.find(".J_toggle").show()}}r=r||this.$el.find(".J_nav"),r.css("margin-left",0-r.width()/2),this.$item=this.$el.find("li"),this.$pointer=r.find("a"),this.options.effect=="slide"&&this.slideInit()},tpl:["{@if images.length>0}",'<a href="javascript:;" class="index_focus_pre J_toggle" data-direction="prev" title="上一张">上一张</a>','<a href="javascript:;" class="index_focus_next J_toggle" data-direction="next" title="下一张">下一张</a>',"{@/if}","<ul>","{@each images as image}","<li>",'<a href="#" class="pic" title="">','<div class="index_focus_info J_focus_info">',"<h3>{{image.title}}</h3>",'<p class="text">{{{image.text}}}</p>',"</div>",'<img class="pic" src="{{image.src}}" width="1600" height="600" alt=""/>',"</a>","</li>","{@/each}","</ul>",'<div class="slide_nav J_nav">',"{@if images.length>0}","{@each images as image,index}",'<a href="javascript:;" class="J_goto" data-index="{{index}}"{@if index==0} class="cur"{@/if}>●</a>',"{@/each}","{@/if}","</div>"].join(""),toggle:function(e){var t=$(e.currentTarget).data().direction;this.go(t)},go:function(e){if(e=="prev"){var t=this.current-1;t<0&&(t=this.count-1)}else{var t=this.current+1;t>=this.count&&(t=0)}this.show(t,e)},"goto":function(e){var t=$(e.currentTarget).data().index;this.current!=t&&this.show(t,this.current>t?"prev":"next")},auto:function(){if(this.count>1){var e=this;clearTimeout(this._t),this.isPause||(this._t=setTimeout(function(){e.go("next")},this.options.duration))}},show:function(e,t){var n=$(this.$item[this.current]),r=$(this.$item[e]);this.options.effect=="fade"?this.fade(n,r):this.options.effect=="slide"&&(t?this.slide(n,r,t):(r.show(),this.onShowNext(r))),$(this.$pointer[this.current]).removeClass("cur"),$(this.$pointer[e]).addClass("cur"),this.current=e},fade:function(e,t){var n=this;e.stop(!0,!0).fadeOut(600,function(){n.onHidePrev(e)}),t.stop(!0,!0).fadeIn(600,function(){n.onShowNext($(this))})},slide:function(e,t,n){var r=this,i=t.clone().show(),s;n=="next"?(e.after(i),s=-this.imgWidth):n=="prev"&&(e.before(i),this.$ul.css("margin-left",-this.imgWidth),s=0),this.$ul.stop(!0,!0).animate({"margin-left":s},600,function(){i.remove(),e.hide(),t.show(),r.$ul.css("margin-left",0),r.onHidePrev(e),r.onShowNext(t)})},slideInit:function(){this.$ul=this.$el.find("ul"),this.imgWidth=this.$item.width(),this.$ul.css("width",this.imgWidth*2)},onHidePrev:function(e){this.findInfo(e).hide(),this.findTitle(e).stop(!0,!0).hide(),this.findText(e).hide()},onShowNext:function(e){var t=this;this.findInfo(e).show(),this.findTitle(e).fadeIn().queue(function(){var n=$(this);t.findText(e).fadeIn(function(){n.dequeue()})}),this.auto()},findInfo:function(e){return e.find(".J_focus_info")},findTitle:function(e){return e.find("h3")},findDesc:function(e){return e.find("h4")},findText:function(e){return e.find(".text")},pause:function(){clearTimeout(this._t),this.isPause=!0},play:function(){this.isPause=!1,this.auto()}}),i=function(e,t){var n=t||{};return n.el=e,new r(n)};n.exports=i});