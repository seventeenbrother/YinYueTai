define(["require","exports","module","juicer","modules/widget/slider","./bannerslide","modules/widget/turn-v2","user","./tpl","modules/widget/dialog/popup"],function(e,t,n){function m(){v.init(),u.isLogined()&&(d=u.get("userId"),p({type:"regist",device:"pc",userId:d}).show().then(function(e){})),window.onload=function(){Y.Cookie.get("icon")?$(".investigation").hide():($(".investigation").show(),Y.Cookie.set("icon","1",{expires:1}))}}var r=e("juicer"),i=e("modules/widget/slider"),s=e("./bannerslide"),o=e("modules/widget/turn-v2"),u=e("user"),a=e("./tpl"),f=1,l=1,c=!1,h=!1,p=e("modules/widget/dialog/popup"),d="",v={init:function(){this.getBanner(),this.getFirstMv("all",32),this.getRecData("",{recId:8,size:8}),this.getRecData($(".hotList"),{recId:9,size:30}),this.getRecData($(".sceneList"),{recId:12,xc:!0}),this.getRecData($(".artistList"),{recId:13}),this.getRecData($(".officialList"),{recId:14,gf:!0}),this.loadMore(),this.adjustDimensions(),this.events(),u.isLogined()||$(".loginTip").show()},events:function(){var e=this,t=$("body"),n=$(".titleBox_entertain"),r=$(".titleBox_official");$(window).resize(function(){e.adjustDimensions(),e.loadMore()}),$(window).scroll(function(){e.loadMore()}),t.on("mouseover",".vchart_item",function(e){var t=$(e.currentTarget);t.addClass("vchart_item_active").siblings(".vchart_item").removeClass("vchart_item_active vchart_item01")}),t.on("mouseover",".program_item",function(e){var t=$(e.currentTarget);t.addClass("program_item_active").siblings(".program_item").removeClass("program_item_active program_item01")}),$(".J_area").on("click",function(){var t=$(this);t.parents("li").addClass("cur").siblings("li").removeClass("cur");var n=t.data("area"),r=n=="all"?32:36;e.getFirstMv(n,r)}),n.on("click",".J_type",function(t){var n=$(t.currentTarget);n.parents("li").addClass("cur").siblings("li").removeClass("cur");var r=n.data("id"),i=n.data("img"),s=i?32:36;e.getRecData($(".entertainList"),{cataId:r,withBigImg:i,size:s})}),r.on("click",".J_type",function(t){var n=$(t.currentTarget);n.parents("li").addClass("cur").siblings("li").removeClass("cur");var r=n.data("id"),i=n.data("img"),s=i?32:36;e.getRecData($(".officialList"),{cataId:r,gf:!0,withBigImg:i,size:s})}),$(".J_change_hot").on("click",function(){f>=5?f=1:f++,$(".hotList").find("li").hide(),$(".hotList").find(".hot_group"+f).show()}),$(".J_change_guess").on("click",function(){l>=5?l=1:l++,$(".guessList").find("li").hide(),$(".guessList").find(".guess_group"+l).show()})},getBanner:function(){$.ajax({url:"/mv/get-bigpic",dataType:"json",data:{},success:function(e){e&&!e.error&&($(".slideContent ul").html(r(a.bannerTpl,e)),$(".bannerTitleBox").html(r(a.bannerTitleTpl,e)),new s)}})},getFirstMv:function(e,t){var n=this,s=$(".firstMvList");s.html("").siblings(".loading").show(),$.ajax({url:"/mv/get-first-video",dataType:"json",data:{area:e,size:t},success:function(t){t&&!t.error&&(s.siblings(".loading").hide(),s.html(r(a.firstMvTpl,t)),e=="all"&&new i($(".sliderBox"),{effect:"slide",duration:1e4}),n.turnMv(s))}})},getRecData:function(e,t){var n=this;e&&e.html("").siblings(".loading").show(),$.ajax({url:"/mv/get-rec",dataType:"json",data:t,success:function(i){if(i&&!i.error){e&&e.siblings(".loading").hide(),t.recId==8&&$(".titleBox_entertain").append(r(a.entertainTitleTpl,i)).find("li").eq(0).find(".J_type").click(),t.recId==14&&$(".titleBox_official").append(r(a.officialTitleTpl,i)).find("li").eq(0).find(".J_type").click(),t.recId==13&&($(".titleBox_artist").append(r(a.artistTitleTpl,i)),e.html(r(a.artistTpl,i)).find(".hot_group1").show());if(t.cataId&&!t.gf){var s=i;s.id=t.cataId,e.html(r(a.entertainTpl,s)),n.turnMv(e)}if(t.recId==12){var s=i;s.id=t.recId,e.html(r(a.sceneTpl,s)),$(".titleBox_scene").next(".line").hide(),n.turnMv(e)}if(t.cataId&&t.gf){var s=i;s.id=t.cataId,e.html(r(a.officialTpl,s)),n.turnMv(e)}if(t.recId==14){var s=i;s.id=t.recId,e.html(r(a.officialTpl,s)),n.turnMv(e)}t.recId==9&&e.html(r(a.hotTpl,i)).find(".hot_group1").show(),t.recId==10&&($(".titleLink_vchart").html(r(a.vchartLinkTpl,i)),e.html(r(a.vchartTpl,i))),t.recId==11&&e.html(r(a.programTpl,i))}}})},getPlaylist:function(){var e=$(".playlistList");e.siblings(".loading").show(),$.ajax({url:"/mv/get-playlist",dataType:"json",data:{size:6},success:function(t){t&&!t.error&&(e.siblings(".loading").hide(),e.html(r(a.playlistTpl,t)))}})},getGuess:function(){var e=$(".guessList");e.siblings(".loading").show(),$.ajax({url:"/mv/get-guess",dataType:"json",data:{size:30},success:function(t){t&&!t.error&&(e.siblings(".loading").hide(),e.html(r(a.guessTpl,t)).find(".guess_group1").show())}})},turnMv:function(e){var t=$(".index_auto"),n;t.hasClass("index_s")?n=4:t.hasClass("index_m")?n=5:n=6;var r=new o($(".index_content"),{sliderEl:e,els:e.find(".mv_x2"),perWidth:250,preBtn:e.parent().siblings(".J_prev"),nextBtn:e.parent().siblings(".J_next"),countInSight:n});r.goto(0)},adjustDimensions:function(){var e=1255,t=1505,n=$(".index_auto"),r,i=$("body").width(),s=$(".autoBox");i<e?(n.removeClass("index_m").addClass("index_s"),s.width(970)):i<t?(n.removeClass("index_s").addClass("index_m"),s.width(1220)):(n.removeClass("index_s index_m"),s.width(1470)),this.turnMv($(".firstMvList")),this.turnMv($(".entertainList")),this.turnMv($(".sceneList"))},isLoadMore:function(){var e=$(window).height(),t=$(window).scrollTop(),n=$(".secondPage").offset().top;return n<t+e?!0:!1},loadMore:function(){if(h)return;c||this.isLoadMore()&&(h=!0,this.getRecData($(".vchartList"),{recId:10,size:3,full:!0}),this.getRecData($(".programList"),{recId:11,size:3,full:!0}),this.getPlaylist(),this.getGuess(),h=!1,c=!0)}};n.exports={init:m}});