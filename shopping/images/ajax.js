define(["require","exports","module","uri","modules/yinyuetai/secret","ajaxform"],function(e,t,n){var r=e("uri"),i=e("modules/yinyuetai/secret"),s=[],o=function(e,t){return typeof e=="string"&&typeof t=="string"?e===t:typeof e=="object"&&typeof t=="object"?$.param(e)===$.param(t):!1},u=function(e){var t=(new r(e)).host();return t!==""&&t!==document.domain},a=function(e){var t=$('<form method="post"></form>').attr({action:e.url}).appendTo(document.body),n=e.data||"",r,i={};return typeof n=="string"?(r=n.split("&"),$.each(r,function(e,t){t=t.split("="),i[t[0]]=t[1]})):i=n,$.each(i,function(e,n){$('<input type="hidden"/>').attr({name:e,value:n}).appendTo(t)}),t},f=function(t){var n=e("ajaxform"),r=a(t);new n(r,{secretParam:t.secretParam||function(){return[]},onComplete:function(e){$(r.attr("target")).remove(),r.remove(),t.success&&t.success(e),_.isFunction(t.complete)?t.complete(e):_.isArray(t.complete)&&_.each(t.complete,function(t){t(e)})}}),r.submit()},l=function(e){for(var t=0,n=s.length;t<n;t++){var r=s[t];if(e.url==r.url&&o(r.data,e.data))return!1}s.push(e);var i=e.type.toLowerCase();if(u(e.url)){if(i==="post")return f(e),!1;e.dataType="jsonp"}else if(i==="post"){var a=c(e.secretName,e.secretParam);a&&(e.data?typeof e.data=="string"?e.data+="&"+$.param(a):e.data=$.extend(e.data,a):e.data=a)}return e},c=function(e,t){return i[e]?i[e](t()):null};return{ajax:function(e){var t=[function(){s=_.without(s,e)}];e.complete&&(t=t.concat(e.complete)),e.complete=undefined,e=$.extend({timeout:1e4,jsonp:"callback",type:"get",secretName:"des",secretParam:function(){return[]},complete:t},e);var n=!0;e.beforeSend&&typeof e.beforeSend=="function"&&(n=e.beforeSend());if(n===!1)return;var r=l(e);if(r)return $.ajax(r)},get:function(e,t,n,r){var i={type:"GET"};return e&&(i.url=e),t&&(i.data=t),n&&(i.success=n),r&&(i.dataType=r),this.ajax(i)},getJSON:function(e,t,n){return this.get(e,t,n,"json")},post:function(e,t,n,r){var i={type:"POST"};return e&&(i.url=e),t&&(i.data=t),n&&(i.success=n),r&&(i.dataType=r),this.ajax(i)}}});